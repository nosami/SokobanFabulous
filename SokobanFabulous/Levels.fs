[<AutoOpen>]
module Levels

let levels = [|
    """
!!!!#####!!!!!!!!!!
!!!!#   #!!!!!!!!!!
!!!!#$  #!!!!!!!!!!
!!###  $##!!!!!!!!!
!!#  $ $ #!!!!!!!!!
### # ## #!!!######
#   # ## #####  ..#
# $  $          ..#
##### ### #@##  ..#
!!!!#     #########
!!!!#######!!!!!!!!
    """

    """
############!!
#..  #     ###
#..  # $  $  #
#..  #$####  #
#..    @ ##  #
#..  # #  $ ##
###### ##$ $ #
!!# $  $ $ $ #
!!#    #     #
!!############
    """

    """
!!!!!!!!########!
!!!!!!!!#     @#!
!!!!!!!!# $#$ ##!
!!!!!!!!# $  $#!!
!!!!!!!!##$ $ #!!
######### $ # ###
#....  ## $  $  #
##...    $  $   #
#....  ##########
########!!!!!!!!!
    """

    """
!!!!!!!!!!!########
!!!!!!!!!!!#  ....#
############  ....#
#    #  $ $   ....#
# $$$#$  $ #  ....#
#  $     $ #  ....#
# $$ #$ $ $########
#  $ #     #!!!!!!!
## #########!!!!!!!
#    #    ##!!!!!!!
#     $   ##!!!!!!!
#  $$#$$  @#!!!!!!!
#    #    ##!!!!!!!
###########!!!!!!!!
    """

    """
!!!!!!!!#####!!!!
!!!!!!!!#   #####
!!!!!!!!# #$##  #
!!!!!!!!#     $ #
######### ###   #
#....  ## $  $###
#....    $ $$ ##!
#....  ##$  $ @#!
#########  $  ##!
!!!!!!!!# $ $  #!
!!!!!!!!### ## #!
!!!!!!!!!!#    #!
!!!!!!!!!!######!
    """

    """
######!!###!
#..  #!##@##
#..  ###   #
#..     $$ #
#..  # # $ #
#..### # $ #
#### $ #$  #
!!!#  $# $ #
!!!# $  $  #
!!!#  ##   #
!!!#########
    """

    """
!!!!!!!#####!
!#######   ##
## # @## $$ #
#    $      #
#  $  ###   #
### #####$###
# $  ### ..#!
# $ $ $ ...#!
#    ###...#!
# $$ #!#...#!
#  ###!#####!
####!!!!!!!!!
    """

    """
!!####!!!!!!!!!!
!!#  ###########
!!#    $   $ $ #
!!# $# $ #  $  #
!!#  $ $  #    #
### $# #  #### #
#@#$ $ $  ##   #
#    $ #$#   # #
#   $    $ $ $ #
#####  #########
!!#      #!!!!!!
!!#      #!!!!!!
!!#......#!!!!!!
!!#......#!!!!!!
!!#......#!!!!!!
!!########!!!!!!
    """

    """
!!!!!!!!!!#######
!!!!!!!!!!#  ...#
!!!!!!#####  ...#
!!!!!!#      . .#
!!!!!!#  ##  ...#
!!!!!!## ##  ...#
!!!!!### ########
!!!!!# $$$ ##!!!!
!#####  $ $ #####
##   #$ $   #   #
#@ $  $    $  $ #
###### $$ $ #####
!!!!!#      #!!!!
!!!!!########!!!!
    """

    """
!###!!#############
##@####       #   #
# $$   $$  $ $ ...#
#  $$$#    $  #...#
# $   # $$ $$ #...#
###   #  $    #...#
#     # $ $ $ #...#
#    ###### ###...#
## #  #  $ $  #...#
#  ## # $$ $ $##..#
# ..# #  $      #.#
# ..# # $$$ $$$ #.#
##### #       # #.#
!!!!# ######### #.#
!!!!#           #.#
!!!!###############
    """

    """
!!!!!!!!!!####!!!!!
!!!!!####!#  #!!!!!
!!!### @###$ #!!!!!
!!##      $  #!!!!!
!##  $ $$## ##!!!!!
!#  #$##     #!!!!!
!# # $ $$ # ###!!!!
!#   $ #  # $ #####
####    #  $$ #   #
#### ## $         #
#.    ###  ########
#.. ..# ####!!!!!!!
#...#.#!!!!!!!!!!!!
#.....#!!!!!!!!!!!!
#######!!!!!!!!!!!!
    """

    """
################!
#              #!
# # ######     #!
# #  $ $ $ $#  #!
# #   $@$   ## ##
# #  $ $ $###...#
# #   $ $  ##...#
# ###$$$ $ ##...#
#     # ## ##...#
#####   ## ##...#
!!!!#####     ###
!!!!!!!!#     #!!
!!!!!!!!#######!!
    """

    """
!!!#########!!!!!!!
!!##   ##  #####!!!
###     #  #    ###
#  $ #$ #  #  ... #
# # $#@$## # #.#. #
#  # #$  #    . . #
# $    $ # # #.#. #
#   ##  ##$ $ . . #
# $ #   #  #$#.#. #
## $  $   $  $... #
!#$ ######    ##  #
!#  #!!!!##########
!####!!!!!!!!!!!!!!
    """

    """
!!!!!!!#######!!!!
!#######     #!!!!
!#     # $@$ #!!!!
!#$$ #   #########
!# ###......##   #
!#   $......## # #
!# ###......     #
##   #### ### #$##
#  #$   #  $  # #!
#  $ $$$  # $## #!
#   $ $ ###$$ # #!
#####     $   # #!
!!!!### ###   # #!
!!!!!!#     #   #!
!!!!!!########  #!
!!!!!!!!!!!!!####!
    """

    """
!!!########!!!!!!
!!!#   #  #!!!!!!
!!!#  $   #!!!!!!
!### #$   ####!!!
!#  $  ##$   #!!!
!#  # @ $ # $#!!!
!#  #      $ ####
!## ####$##     #
!# $#.....# #   #
!#  $..**. $# ###
##  #.....#   #!!
#   ### #######!!
# $$  #  #!!!!!!!
#  #     #!!!!!!!
######   #!!!!!!!
!!!!!#####!!!!!!!
    """

    """
#####!!!!!!!!!
#   ##!!!!!!!!
#    #!!####!!
# $  ####  #!!
#  $$ $   $#!!
###@ #$    ##!
!#  ##  $ $ ##
!# $  ## ## .#
!#  #$##$  #.#
!###   $..##.#
!!#    #.*...#
!!# $$ #.....#
!!#  #########
!!#  #!!!!!!!!
!!####!!!!!!!!
    """

    """
!!!##########!!!
!!!#..  #   #!!!
!!!#..      #!!!
!!!#..  #  ####!
!!######   #  ##
!!#            #
!!#  #  ##  #  #
#### ##  #### ##
#  $  ##### #  #
# # $  $  # $  #
# @$  $   #   ##
#### ## #######!
!!!#    #!!!!!!!
!!!######!!!!!!!
    """

    """
!!!!!###########!!!
!!!!!#  .  #   #!!!
!!!!!# #.    @ #!!!
!##### ##..# ####!!
##  # ..###     ###
# $ #...   $ #  $ #
#    .. ##  ## ## #
####$##$# $ #   # #
!!## #    #$ $$ # #
!!#  $ # #  # $## #
!!#               #
!!#  ###########  #
!!####!!!!!!!!!####
    """

    """
!!######!!!!!!!!!!!
!!#   @####!!!!!!!!
##### $   #!!!!!!!!
#   ##    ####!!!!!
# $ #  ##    #!!!!!
# $ #  ##### #!!!!!
## $  $    # #!!!!!
## $ $ ### # #!!!!!
## #  $  # # #!!!!!
## # #$#   # #!!!!!
## ###   # # ######
#  $  #### # #....#
#    $    $   ..#.#
####$  $# $   ....#
#       #  ## ....#
###################
    """

    """
!!!!##########!!!!!
#####        ####!!
#     #   $  #@ #!!
# #######$####  ###
# #    ## #  #$ ..#
# # $     #  #  #.#
# # $  #     #$ ..#
# #  ### ##     #.#
# ###  #  #  #$ ..#
# #    #  ####  #.#
# #$   $  $  #$ ..#
#    $ # $ $ #  #.#
#### $###    #$ ..#
!!!#    $$ ###....#
!!!#      ##!######
!!!########!!!!!!!!
    """

    """
#########!!!!!!
#       #!!!!!!
#       ####!!!
## #### #  #!!!
## #@##    #!!!
# $$$ $  $$#!!!
#  # ## $  #!!!
#  # ##  $ ####
####  $$$ $#  #
!#   ##   ....#
!# #   # #.. .#
!#   # # ##...#
!##### $  #...#
!!!!!##   #####
!!!!!!#####!!!!
    """

    """
######!!!!!####!!!!
#    #######  #####
#   $#  #  $  #   #
#  $  $  $ # $ $  #
##$ $   # @# $    #
#  $ ########### ##
# #   #.......# $#!
# ##  # ......#  #!
# #   $........$ #!
# # $ #.... ..#  #!
#  $ $####$#### $#!
# $   ### $   $  ##
# $     $ $  $    #
## ###### $ ##### #
#         #       #
###################
    """

    """
!!!!#######!!!!!!!!
!!!!#  #  ####!!!!!
##### $#$ #  ##!!!!
#.. #  #  #   #!!!!
#.. # $#$ #  $####!
#.  #     #$  #  #!
#..   $#  # $    #!
#..@#  #$ #$  #  #!
#.. # $#     $#  #!
#.. #  #$$#$  #  ##
#.. # $#  #  $#$  #
#.. #  #  #   #   #
##. ####  #####   #
!####!!####!!!#####
    """

    """
###############!!!!
#..........  .####!
#..........$$.#  #!
###########$ #   ##
#      $  $     $ #
## ####   #  $ #  #
#      #   ##  # ##
#  $#  # ##  ### ##
# $ #$###    ### ##
###  $ #  #  ### ##
###    $ ## #  # ##
!# $  #  $  $ $   #
!#  $  $#$$$  #   #
!#  #  $      #####
!# @##  #  #  #!!!!
!##############!!!!
    """

    """
####!!!!!!!!!!!!!!!
#  ##############!!
#  #   ..#......#!!
#  # # ##### ...#!!
##$#    ........#!!
#   ##$######  ####
# $ #     ######@ #
##$ # $   ######  #
#  $ #$$$##       #
#      #    #$#$###
# #### #$$$$$    #!
# #    $     #   #!
# #   ##        ###
# ######$###### $ #
#        #!!!!#   #
##########!!!!#####
    """

    """
!#######!!!!!!!
!#  #  #####!!!
##  #  #...###!
#  $#  #...  #!
# $ #$$ ...  #!
#  $#  #... .#!
#   # $########
##$       $ $ #
##  #  $$ #   #
!######  ##$$@#
!!!!!!#      ##
!!!!!!########!
    """

    """
!#################!
!#...   #    #   ##
##.....  $## # #$ #
#......#  $  #    #
#......#  #  # #  #
######### $  $ $  #
!!#     #$##$ ##$##
!##   $    # $    #
!#  ## ### #  ##$ #
!# $ $$     $  $  #
!# $    $##$ ######
!#######  @ ##!!!!!
!!!!!!!######!!!!!!
    """

    """
!!!!!!!!!#####!!!
!!!!!#####   #!!!
!!!!## $  $  ####
##### $  $ $ ##.#
#       $$  ##..#
#  ###### ###.. #
## #  #    #... #
# $   #    #... #
#@ #$ ## ####...#
####  $ $$  ##..#
!!!##  $ $  $...#
!!!!# $$  $ #  .#
!!!!#   $ $  ####
!!!!######   #!!!
!!!!!!!!!#####!!!
    """

    """
#####!!!!!!!!!!!!!!
#   ##!!!!!!!!!!!!!
# $  #########!!!!!
## # #       ######
## #   $#$#@  #   #
#  #      $ #   $ #
#  ### ######### ##
#  ## ..*..... # ##
## ## *.*..*.* # ##
# $########## ##$ #
#  $   $  $    $  #
#  #   #   #   #  #
###################
    """

    """
!!!!!!!###########!
!!!!!!!#   #     #!
#####!!#     $ $ #!
#   ##### $## # ##!
# $ ##   # ## $  #!
# $  @$$ # ##$$$ #!
## ###   # ##    #!
## #   ### #####$#!
## #     $  #....#!
#  ### ## $ #....##
# $   $ #   #..$. #
#  ## $ #  ##.... #
#####   ######...##
!!!!#####!!!!#####!
    """

    """
!!####!!!!!!!!!!!!
!!#  #########!!!!
!##  ##  #   #!!!!
!#  $# $@$   ####!
!#$  $  # $ $#  ##
##  $## #$ $     #
#  #  # #   $$$  #
# $    $  $## ####
# $ $ #$#  #  #!!!
##  ###  ###$ #!!!
!#  #....     #!!!
!####......####!!!
!!!#....####!!!!!!
!!!#...##!!!!!!!!!
!!!#...#!!!!!!!!!!
!!!#####!!!!!!!!!!
    """

    """
!!!!!!####!!!
!!#####  #!!!
!##     $#!!!
## $  ## ###!
#@$ $ # $  #!
#### ##   $#!
!#....#$ $ #!
!#....#   $#!
!#....  $$ ##
!#... # $   #
!######$ $  #
!!!!!!#   ###
!!!!!!#$ ###!
!!!!!!#  #!!!
!!!!!!####!!!
    """

    """
############
##     ##  #
##   $   $ #
#### ## $$ #
#   $ #    #
# $$$ # ####
#   # # $ ##
#  #  #  $ #
# $# $#    #
#   ..# ####
####.. $ #@#
#.....# $# #
##....#  $ #
###..##    #
############
    """

    """
!#########!!!!
!#....   ##!!!
!#.#.#  $ ##!!
##....# # @##!
# ....#  #  ##
#     #$ ##$ #
## ###  $    #
!#$  $ $ $#  #
!# #  $ $ ## #
!#  ###  ##  #
!#    ## ## ##
!#  $ #  $  #!
!###$ $   ###!
!!!#  #####!!!
!!!####!!!!!!!
    """

    """
############!######
#   #    # ###....#
#   $$#   @  .....#
#   # ###   # ....#
## ## ###  #  ....#
!# $ $     # # ####
!#  $ $##  #      #
#### #  #### # ## #
#  # #$   ## #    #
# $  $  # ## #   ##
# # $ $    # #   #!
#  $ ## ## # #####!
# $$     $$  #!!!!!
## ## ### $  #!!!!!
!#    #!#    #!!!!!
!######!######!!!!!
    """

    """
!!!!!!!!!!!!#####!!
#####!!######   #!!
#   ####  $ $ $ #!!
# $   ## ## ##  ##!
#   $ $     $  $ #!
### $  ## ##     ##
!!# ##### #####$$ #
!##$##### @##     #
!# $  ###$### $  ##
!# $  #   ###  ###!
!# $$ $ #   $$ #!!!
!#     #   ##  #!!!
!#######.. .###!!!!
!!!!#.........#!!!!
!!!!#.........#!!!!
!!!!###########!!!!
    """

    """
###########!!!!!!!!
#......   #########
#......   #  ##   #
#..### $    $     #
#... $ $ #   ##   #
#...#$#####    #  #
###    #   #$  #$ #
!!#  $$ $ $  $##  #
!!#  $   #$#$ ##$ #
!!### ## #    ##  #
!!!#  $ $ ## ######
!!!#    $  $  #!!!!
!!!##   # #   #!!!!
!!!!#####@#####!!!!
!!!!!!!!###!!!!!!!!
    """

    """
!!!!!!####!
####### @#!
#     $  #!
#   $## $#!
##$#...# #!
!# $...  #!
!# #. .# ##
!#   # #$ #
!#$  $    #
!#  #######
!####!!!!!!
    """

    """
!!!!!!!!!!!!!######
!#############....#
##   ##     ##....#
#  $$##  $ @##....#
#      $$ $#  ....#
#  $ ## $$ # # ...#
#  $ ## $  #  ....#
## ##### ### ##.###
##   $  $ ##   .  #
# $###  # ##### ###
#   $   #       #!!
#  $ #$ $ $###  #!!
# $$$# $   # ####!!
#    #  $$ #!!!!!!!
######   ###!!!!!!!
!!!!!#####!!!!!!!!!
    """

    """
!!!!############!
!!!!#          ##
!!!!#  # #$$ $  #
!!!!#$ #$#  ## @#
!!!## ## # $ # ##
!!!#   $ #$  # #!
!!!#   # $   # #!
!!!## $ $   ## #!
!!!#  #  ##  $ #!
!!!#    ## $$# #!
######$$   #   #!
#....#  ########!
#.#... ##!!!!!!!!
#....   #!!!!!!!!
#....   #!!!!!!!!
#########!!!!!!!!
    """

    """
!!!!!!!!!!!#####!!!
!!!!!!!!!!##   ##!!
!!!!!!!!!##     #!!
!!!!!!!!##  $$  #!!
!!!!!!!## $$  $ #!!
!!!!!!!# $    $ #!!
####!!!#   $$ #####
#  ######## ##    #
#.            $$$@#
#.# ####### ##   ##
#.# #######. #$ $##
#........... #    #
##############  $ #
!!!!!!!!!!!!!##  ##
!!!!!!!!!!!!!!####!
    """

    """
!!!!!########!!!!!
!!####      ######
!!#    ## $ $   @#
!!# ## ##$#$ $ $##
### ......#  $$ ##
#   ......#  #   #
# # ......#$  $  #
# #$...... $$# $ #
#   ### ###$  $ ##
###  $  $  $  $ #!
!!#  $  $  $  $ #!
!!######   ######!
!!!!!!!#####!!!!!!
    """

    """
!!!!!!!!#######!!!!
!!!!#####  #  ####!
!!!!#   #   $    #!
!#### #$$ ## ##  #!
##      # #  ## ###
#  ### $#$  $  $  #
#...    # ##  #   #
#...#    @ # ### ##
#...#  ###  $  $  #
########!##   #   #
!!!!!!!!!!#########
    """

    """
!####!!!!!!!!!!!!!!
!#   #!!!!!!!!!!!!!
!# # #######!!!!!!!
!#      $@######!!!
!# $ ##$ ###   #!!!
!# #### $    $ #!!!
!# ##### #  #$ ####
##  #### ##$      #
#  $#  $  # ## ## #
#         # #...# #
######  ###  ...  #
!!!!!####!# #...# #
!!!!!!!!!!# ### # #
!!!!!!!!!!#       #
!!!!!!!!!!#########
    """

    """
#####!####!!!!!!
#...#!#  ####!!!
#...###  $  #!!!
#....## $  $###!
##....##   $  #!
###... ## $ $ #!
# ##    #  $  #!
#  ## # ### ####
# $ # #$  $    #
#  $ @ $    $  #
#   # $ $$ $ ###
#  ######  ###!!
# ##!!!!####!!!!
###!!!!!!!!!!!!!
    """

    """
##########!!!!
#        ####!
# ###### #  ##
# # $ $ $  $ #
#       #$   #
###$  $$#  ###
!!#  ## # $##!
!!##$#   $ @#!
!!!#  $ $ ###!
!!!# #   $  #!
!!!# ##   # #!
!!##  ##### #!
!!#         #!
!!#.......###!
!!#.......#!!!
!!#########!!!
    """

    """
!!!!!!!!!####!!!!!
!#########  ##!!!!
##  $      $ #####
#   ## ##   ##...#
# #$$ $ $$#$##...#
# #   @   #   ...#
#  $# ###$$   ...#
# $  $$  $ ##....#
###$       #######
!!#  #######!!!!!!
!!####!!!!!!!!!!!!
    """

    """
!!#########!!
!!#*.*#*.*#!!
!!#.*.*.*.#!!
!!#*.*.*.*#!!
!!#.*.*.*.#!!
!!#*.*.*.*#!!
!!###   ###!!
!!!!#   #!!!!
###### ######
#           #
# $ $ $ $ $ #
## $ $ $ $ ##
!#$ $ $ $ $#!
!#   $@$   #!
!#  #####  #!
!####!!!####!
    """

    """
!!!!!!!####!!!!!
!!!!!!!#  ##!!!!
!!!!!!!#   ##!!!
!!!!!!!# $$ ##!!
!!!!!###$  $ ##!
!!####    $   #!
###  # #####  #!
#    # #....$ #!
# #   $ ....# #!
#  $ # #.*..# #!
###  #### ### #!
!!#### @$  ##$##
!!!!!### $     #
!!!!!!!#  ##   #
!!!!!!!#########
    """
|]

type Direction = Left | Right | Up | Down

type OnTarget = OnTarget | NotOnTarget

type Square =
    | Player of Direction 
    | Dead
    | Wall
    | Goal
    | Empty
    | Treasure of OnTarget

let mapSquare = function
    | '#' -> Wall
    | ' ' -> Empty
    | '$' -> Treasure NotOnTarget
    | '.' -> Goal
    | '@' -> Player Down
    | '*' -> Treasure OnTarget
    | _ -> Dead

type Point = { x:int; y:int }

type Grid = Map<Point, Square>

type MapParseResult = { playerPos:Point; goalSquares:Set<Point>; map:Grid }

type Map =
    { pushableTreasure: Point option
      playerPos:Point
      level:int
      width:int
      height:int
      map:Grid
      path:(Point * Direction) list
      goalSquares:Set<Point>
      maximumLevelReached: int }

let loadMapFromString (levelNumber:int) lines = 
    let rec parseLine lineNumber colNumber (line:string) (parseResult:MapParseResult) =
        let sq = mapSquare line.[colNumber]
        let pos = { x=colNumber; y=lineNumber }
        let newMap = parseResult.map.Add(pos, sq)
        let result =
            match sq with
            | Player _ -> { parseResult with playerPos = pos; map = newMap }
            | Goal | Treasure OnTarget -> { parseResult with goalSquares = parseResult.goalSquares.Add pos; map = newMap }
            | _ -> { parseResult with map = newMap }

        if colNumber < line.Length-1 then
            parseLine lineNumber (colNumber+1) line result
        else
            result

    let rec parseLines lines lineNumber parseResult =
        match lines with
        | h :: t ->
            let res = parseLine lineNumber 0 h parseResult
            parseLines t (lineNumber+1) res
        | [] -> parseResult

    parseLines lines 0 { playerPos={x=0;y=0}; goalSquares=Set.empty; map=Map.empty }